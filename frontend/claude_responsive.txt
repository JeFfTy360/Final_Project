import React, { useState } from 'react';
import {
    AppBar,
    Toolbar,
    Typography,
    Button,
    Container,
    TextField,
    Grid,
    Card,
    CardContent,
    CardMedia,
    IconButton,
    Box,
    Link,
    Divider,
    Menu,
    MenuItem,
    Avatar,
    Drawer,
    List,
    ListItem,
    useMediaQuery,
    useTheme,
} from '@mui/material';
import {
    Favorite,
    FavoriteBorder,
    Share,
    Home,
    Business,
    DirectionsCar,
    Laptop,
    FavoriteBorderOutlined,
    LocationOn,
    AddCircle,
    MenuBook,
    Menu as MenuIcon,
} from '@mui/icons-material';
import { ThemeProvider, createTheme, styled } from '@mui/material/styles';

const theme = createTheme({
    palette: {
        primary: {
            main: '#1976d2',
        },
        secondary: {
            main: '#14b8a6',
        },
    },
    breakpoints: {
        values: {
            xs: 0,
            sm: 600,
            md: 900,
            lg: 1200,
            xl: 1536,
        },
    },
});

// Styled Components
const ToolBarStyled = styled(Toolbar)(({ theme }) => ({
    width: "100%",
    minHeight: "64px",
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    padding: theme.spacing(1, 2),
    [theme.breakpoints.down('sm')]: {
        minHeight: "56px",
        padding: theme.spacing(1),
    },
}));

const TitleTypography = styled(Typography)(({ theme }) => ({
    fontFamily: "'Archivo Black', sans-serif",
    fontWeight: 800,
    fontSize: "30px",
    color: "#000000",
    [theme.breakpoints.down('sm')]: {
        fontSize: "24px",
    },
    [theme.breakpoints.down('xs')]: {
        fontSize: "20px",
    },
}));

const GroupOptionsText = styled(Box)(({ theme }) => ({
    display: "none",
    [theme.breakpoints.up('md')]: {
        display: "flex",
        justifyContent: "space-around",
        alignItems: "center",
        gap: theme.spacing(1),
        flexWrap: "wrap",
    },
}));

const PublishButtonStyled = styled(Button)(({ theme }) => ({
    background: 'linear-gradient(90deg, #FF8839 0%, #FF8839 100%)',
    borderRadius: 5,
    textTransform: 'none',
    fontSize: 16,
    padding: theme.spacing(1.5, 3),
    [theme.breakpoints.down('sm')]: {
        fontSize: 14,
        padding: theme.spacing(1, 2),
    },
}));

// AvatarMenu Component
function AvatarMenu() {
    const [anchorEl, setAnchorEl] = useState(null);
    const open = Boolean(anchorEl);

    const handleClick = (event) => {
        setAnchorEl(event.currentTarget);
    };

    const handleClose = () => {
        setAnchorEl(null);
    };

    return (
        <>
            <IconButton onClick={handleClick} sx={{ p: 0.5 }}>
                <Avatar
                    src="/avatar.png"
                    sx={{ 
                        width: { xs: 32, sm: 40 }, 
                        height: { xs: 32, sm: 40 }, 
                        cursor: "pointer", 
                        bgcolor: "#00777D" 
                    }}
                />
            </IconButton>
            <Menu
                anchorEl={anchorEl}
                open={open}
                onClose={handleClose}
                anchorOrigin={{ vertical: "bottom", horizontal: "right" }}
                transformOrigin={{ vertical: "top", horizontal: "right" }}
            >
                <MenuItem onClick={handleClose}>Voir profil</MenuItem>
                <MenuItem onClick={handleClose}>Paramètres</MenuItem>
                <MenuItem onClick={handleClose}>Déconnexion</MenuItem>
            </Menu>
        </>
    );
}

// BtnAuth Component
function BtnAuth() {
    const [user, setUser] = useState(null);
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down('sm'));

    return (
        <Box sx={{ 
            display: "flex", 
            gap: { xs: 1, sm: 2 },
            flexDirection: { xs: 'row', sm: 'row' },
            alignItems: "center"
        }}>
            {!user ? (
                <>
                    <Button 
                        variant="outlined" 
                        sx={{ 
                            color: "black",
                            fontSize: { xs: '0.75rem', sm: '0.875rem' },
                            padding: { xs: '4px 8px', sm: '6px 16px' },
                            minWidth: { xs: '70px', sm: '90px' }
                        }}
                    >
                        {isMobile ? 'Login' : 'Se connecter'}
                    </Button>
                    <Button 
                        sx={{ 
                            backgroundColor: "#044B6F",
                            fontSize: { xs: '0.75rem', sm: '0.875rem' },
                            padding: { xs: '4px 8px', sm: '6px 16px' },
                            minWidth: { xs: '70px', sm: '90px' }
                        }} 
                        variant="contained"
                    >
                        {isMobile ? 'Sign up' : "S'inscrire"}
                    </Button>
                </>
            ) : (
                <AvatarMenu />
            )}
        </Box>
    );
}

// Header Component
function Header() {
    const [mobileOpen, setMobileOpen] = useState(false);

    const handleDrawerToggle = () => {
        setMobileOpen(!mobileOpen);
    };

    const drawer = (
        <Box onClick={handleDrawerToggle} sx={{ textAlign: 'center', p: 2 }}>
            <Typography variant="h6" sx={{ my: 2, fontWeight: 'bold' }}>
                TCHEKEM
            </Typography>
            <List>
                {['For business', 'En', 'Maps', 'Monnaie', 'Catalogues', 'Customer service'].map((text) => (
                    <ListItem key={text} sx={{ justifyContent: 'center' }}>
                        <Button fullWidth>{text}</Button>
                    </ListItem>
                ))}
                <ListItem sx={{ justifyContent: 'center', mt: 2 }}>
                    <BtnAuth />
                </ListItem>
            </List>
        </Box>
    );

    return (
        <>
            <ToolBarStyled>
                <TitleTypography variant="h6">
                    TCHEKEM
                </TitleTypography>
                
                <GroupOptionsText>
                    <Button size="small">For business</Button>
                    <Button size="small" startIcon={<MenuBook />}>En</Button>
                    <Button size="small">Maps</Button>
                    <Button size="small">Monnaie</Button>
                    <Button size="small">Catalogues</Button>
                    <Button size="small">Customer service</Button>
                    <BtnAuth />
                </GroupOptionsText>

                <Box sx={{ display: { xs: 'flex', md: 'none' }, gap: 1, alignItems: 'center' }}>
                    <BtnAuth />
                    <IconButton
                        color="inherit"
                        aria-label="open drawer"
                        edge="end"
                        onClick={handleDrawerToggle}
                    >
                        <MenuIcon />
                    </IconButton>
                </Box>
            </ToolBarStyled>

            <Drawer
                variant="temporary"
                anchor="right"
                open={mobileOpen}
                onClose={handleDrawerToggle}
                ModalProps={{ keepMounted: true }}
                sx={{
                    display: { xs: 'block', md: 'none' },
                    '& .MuiDrawer-paper': { boxSizing: 'border-box', width: { xs: '75%', sm: 280 } },
                }}
            >
                {drawer}
            </Drawer>
        </>
    );
}

// SearchBar Component
function SearchBar() {
    return (
        <Container maxWidth="lg" sx={{ mt: { xs: 2, sm: 3, md: 4 }, px: { xs: 2, sm: 3 } }}>
            <Box sx={{ 
                display: 'flex', 
                flexDirection: { xs: 'column', sm: 'row' }, 
                justifyContent: 'center', 
                gap: { xs: 1, sm: 1 }, 
                maxWidth: 600, 
                mx: 'auto' 
            }}>
                <TextField
                    fullWidth
                    placeholder="Rechercher des biens ou services"
                    variant="outlined"
                    size="medium"
                    sx={{ 
                        bgcolor: 'white',
                        '& .MuiOutlinedInput-root': {
                            fontSize: { xs: '0.875rem', sm: '1rem' }
                        }
                    }}
                />
                <Button
                    variant="contained"
                    sx={{
                        bgcolor: '#00777D',
                        '&:hover': { bgcolor: '#005f64' },
                        minWidth: { xs: '100%', sm: 100 },
                        height: { xs: 48, sm: 56 }
                    }}
                >
                    Search
                </Button>
            </Box>

            <Box sx={{ display: 'flex', justifyContent: 'center', mt: { xs: 2, sm: 3 }, px: { xs: 2, sm: 0 } }}>
                <PublishButtonStyled
                    variant="contained"
                    fullWidth
                    sx={{ maxWidth: { xs: '100%', sm: 400 } }}
                    startIcon={<AddCircle />}
                >
                    Publier une annonce
                </PublishButtonStyled>
            </Box>
        </Container>
    );
}

// CategoriesCard Component
function CategoriesCard({ icon, label }) {
    return (
        <Button
            fullWidth
            sx={{
                display: 'flex',
                flexDirection: 'column',
                gap: { xs: 0.5, sm: 1 },
                py: { xs: 2, sm: 3 },
                bgcolor: 'white',
                color: '#00777D',
                '&:hover': { bgcolor: '#f0f0f0' },
                borderRadius: 2,
                minHeight: { xs: 100, sm: 120 }
            }}
        >
            <Box
                sx={{
                    bgcolor: '#e0f2f1',
                    borderRadius: '50%',
                    p: { xs: 1, sm: 1.5, md: 2 },
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                }}
            >
                {React.cloneElement(icon, { sx: { fontSize: { xs: 24, sm: 32, md: 40 } } })}
            </Box>
            <Typography variant="caption" sx={{ 
                textAlign: 'center', 
                color: '#000',
                fontSize: { xs: '0.7rem', sm: '0.75rem' }
            }}>
                {label}
            </Typography>
        </Button>
    );
}

// LocationCard Component
function LocationCard({ location }) {
    return (
        <Button
            sx={{
                display: 'flex',
                flexDirection: 'column',
                gap: 0.5,
                color: '#00777D',
                textTransform: 'none',
                minWidth: { xs: 80, sm: 100 }
            }}
        >
            <LocationOn sx={{ fontSize: { xs: 28, sm: 36, md: 40 } }} />
            <Typography variant="body2" sx={{ fontSize: { xs: '0.75rem', sm: '0.875rem' } }}>
                {location}
            </Typography>
        </Button>
    );
}

// AdCard Component
function AdCard({ price, title, address }) {
    return (
        <Card sx={{ 
            boxShadow: 2, 
            '&:hover': { boxShadow: 4 },
            height: '100%',
            display: 'flex',
            flexDirection: 'column'
        }}>
            <CardMedia
                component="div"
                sx={{
                    height: { xs: 120, sm: 140, md: 160 },
                    bgcolor: '#e0e0e0',
                }}
            />
            <CardContent sx={{ 
                display: 'flex', 
                flexDirection: 'column',
                flexGrow: 1,
                p: { xs: 1, sm: 1.5, md: 2 },
                '&:last-child': { pb: { xs: 1, sm: 1.5, md: 2 } }
            }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <Box sx={{ flexGrow: 1 }}>
                        <Typography variant="body2" sx={{ 
                            fontWeight: 600,
                            fontSize: { xs: '0.875rem', sm: '1rem' }
                        }}>
                            {price}
                        </Typography>
                        <Typography
                            variant="caption"
                            color="text.secondary"
                            sx={{
                                display: "block",
                                fontSize: { xs: '0.7rem', sm: '0.75rem' }
                            }}
                        >
                            {title} d, {address}
                        </Typography>
                    </Box>
                    <Box sx={{ display: 'flex', gap: 0.25, ml: 1 }}>
                        <IconButton size="small" sx={{ color: 'grey.400', p: { xs: 0.25, sm: 0.5 } }}>
                            <FavoriteBorder sx={{ fontSize: { xs: 16, sm: 20 } }} />
                        </IconButton>
                        <IconButton size="small" sx={{ color: 'grey.400', p: { xs: 0.25, sm: 0.5 } }}>
                            <Share sx={{ fontSize: { xs: 16, sm: 20 } }} />
                        </IconButton>
                    </Box>
                </Box>
            </CardContent>
        </Card>
    );
}

// Main App Component
export default function RealEstateApp() {
    const categories = [
        { icon: <Home />, label: 'Appartements' },
        { icon: <Business />, label: 'Entreprise' },
        { icon: <DirectionsCar />, label: 'Garage' },
        { icon: <Laptop />, label: 'Bureau local' },
        { icon: <FavoriteBorderOutlined />, label: 'Santé & Beauté' },
        { icon: <DirectionsCar />, label: 'Loisirs' },
    ];

    const locations = ['Port au prince', 'Jacmel', 'Cap', 'Cayes'];

    const properties = Array.from({ length: 20 }, (_, i) => ({
        id: i + 1,
        title: "maison",
        price: '1256',
        address: 'ZN 9',
    }));

    return (
        <ThemeProvider theme={theme}>
            <Box sx={{ flexGrow: 1, bgcolor: 'white', minHeight: '100vh' }}>
                <Header />
                <SearchBar />

                {/* Categories */}
                <Container maxWidth="lg" sx={{ mt: { xs: 3, sm: 4, md: 6 }, px: { xs: 2, sm: 3 } }}>
                    <Grid container spacing={{ xs: 1.5, sm: 2, md: 3 }}>
                        {categories.map((cat, idx) => (
                            <Grid item xs={6} sm={4} md={2} key={idx}>
                                <CategoriesCard icon={cat.icon} label={cat.label} />
                            </Grid>
                        ))}
                    </Grid>
                </Container>

                {/* Locations */}
                <Container maxWidth="lg" sx={{ mt: { xs: 2, sm: 3, md: 4 }, px: { xs: 2, sm: 3 } }}>
                    <Grid container spacing={{ xs: 1, sm: 2 }} justifyContent="center">
                        {locations.map((loc, idx) => (
                            <Grid item key={idx}>
                                <LocationCard location={loc} />
                            </Grid>
                        ))}
                    </Grid>
                </Container>

                {/* Property Listings */}
                <Container maxWidth="lg" sx={{ mt: { xs: 3, sm: 4, md: 6 }, pb: { xs: 4, sm: 6 }, px: { xs: 2, sm: 3 } }}>
                    {[1, 2, 3, 4, 5].map((section) => (
                        <Box key={section} sx={{ mb: { xs: 4, sm: 5, md: 6 } }}>
                            <Typography variant="h6" sx={{ 
                                mb: { xs: 2, sm: 3 }, 
                                fontWeight: 600,
                                fontSize: { xs: '1rem', sm: '1.25rem' },
                                px: { xs: 1, sm: 0 }
                            }}>
                                Ventes immobilières
                            </Typography>
                            <Grid container spacing={{ xs: 1.5, sm: 2 }}>
                                {properties.slice((section - 1) * 5, section * 5).map((property) => (
                                    <Grid item xs={6} sm={6} md={4} lg={2.4} key={property.id}>
                                        <AdCard title={property.title} price={property.price} address={property.address} />
                                    </Grid>
                                ))}
                            </Grid>
                        </Box>
                    ))}
                </Container>

                {/* Footer */}
                <Box sx={{ bgcolor: '#f5f5f5', borderTop: 1, borderColor: 'divider', py: { xs: 3, sm: 4 } }}>
                    <Container maxWidth="lg" sx={{ px: { xs: 2, sm: 3 } }}>
                        <Grid container spacing={{ xs: 3, sm: 4 }}>
                            <Grid item xs={12} sm={4}>
                                <Typography variant="h6" sx={{ 
                                    fontWeight: 600, 
                                    mb: 2,
                                    fontSize: { xs: '1rem', sm: '1.25rem' }
                                }}>
                                    Information
                                </Typography>
                                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        Termes et Conditions
                                    </Link>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        Nous contacter
                                    </Link>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        Comment ça marche (tutoriel)
                                    </Link>
                                </Box>
                            </Grid>
                            <Grid item xs={12} sm={4}>
                                <Typography variant="h6" sx={{ 
                                    fontWeight: 600, 
                                    mb: 2,
                                    fontSize: { xs: '1rem', sm: '1.25rem' }
                                }}>
                                    Pour les professionnels
                                </Typography>
                                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        Créer un espace public
                                    </Link>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        SYPS
                                    </Link>
                                    <Link href="#" underline="none" color="text.secondary" variant="body2" sx={{ fontSize: { xs: '0.8rem', sm: '0.875rem' } }}>
                                        Pack de professionnelle générale
                                    </Link>
                                </Box>
                            </Grid>
                            <Grid item xs={12} sm={4}>
                                <Typography variant="h6" sx={{ 
                                    fontWeight: 600, 
                                    mb: 2,
                                    fontSize: { xs: '1rem', sm: '1.25rem' }
                                }}>
                                    Nos applications
                                </Typography>
                                <Box sx={{ display: 'flex', gap: 1, flexDirection: { xs: 'row', sm: 'column' }, maxWidth: { xs: '100%', sm: 150 } }}>
                                    <Button
                                        variant="contained"
                                        fullWidth
                                        sx={{ 
                                            bgcolor: '#000', 
                                            '&:hover': { bgcolor: '#333' }, 
                                            textTransform: 'none',
                                            fontSize: { xs: '0.75rem', sm: '0.875rem' }
                                        }}
                                        size="small"
                                    >
                                        App Store
                                    </Button>
                                    <Button
                                        variant="contained"
                                        fullWidth
                                        sx={{ 
                                            bgcolor: '#000', 
                                            '&:hover': { bgcolor: '#333' }, 
                                            textTransform: 'none',
                                            fontSize: { xs: '0.75rem', sm: '0.875rem' }
                                        }}
                                        size="small"
                                    >
                                        Google Play
                                    </Button>
                                </Box>
                            </Grid>
                        </Grid>
                        <Divider sx={{ my: { xs: 2, sm: 3 } }} />
                        <Typography variant="body2" color="text.secondary" align="center" sx={{ fontSize: { xs: '0.75rem', sm: '0.875rem' } }}>
                            © 2015 - 2025 Tchiekem
                        </Typography>
                    </Container>
                </Box>
            </Box>
        </ThemeProvider>
    );
}